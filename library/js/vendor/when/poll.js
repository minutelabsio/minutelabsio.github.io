/** @license MIT License (c) copyright 2012-2013 original author or authors */

(function(e){e(["require","./when","./cancelable","./delay","./function"],function(e){function o(){}function u(e){o.prototype=e;var t=new o;return o.prototype=null,t}var t,n,r,i,s;return t=e("./when"),n=e("./cancelable"),r=e("./delay"),i=e("./function"),function(o,a,f,l){function d(e){c.resolve(e)}function v(e){i.apply(a).then(m,p),e!==s&&c.notify(e)}function m(){if(h)return;t(o(),function(e){t(f(e),function(t){return t?d(e):v(e)},function(){v(e)})},p)}var c,h,p;return h=!1,c=n(t.defer(),function(){h=!0}),p=c.reject,f=f||function(){return!1},typeof a!="function"&&(a=function(e){return function(){return r(e)}}(a)),l?v():m(),c.promise=u(c.promise),c.promise.cancel=c.cancel,c.promise}})})(typeof define=="function"&&define.amd?define:function(e){module.exports=e(require)});