/** @license MIT License (c) copyright B Cavalier & J Hann */

(function(e){e(["require","./when"],function(e){function f(e,n,r,i){var s=[e].concat(m(e,[n,r,i]));return l(t.apply(null,s),t.resolve(e))}function l(e,t){var r,i,o,u;return s.call(e,"parent")?e:(n++,r=t&&"id"in t?t.id+"."+n:n,i=e.then,o=T(e),o.id=r,o.parent=t,o.toString=function(){return y("Promise",r)},o.then=function(t,n,r){E(t,n,r);if(typeof n=="function"){var s=o;do s.handled=!0;while((s=s.parent)&&!s.handled)}return l(i.apply(e,m(o,arguments)),o)},u=function(){console.error(o.toString())},e.then(function(e){return o.toString=function(){return y("Promise",r,"resolved",e)},e},v(o,function(e){throw o.toString=function(){return y("Promise",r,"REJECTED",e)},g("reject",o,e),o.handled||u(),e})),o)}function c(){var e,i,s,o,u,f,c,h,p,d;e=t.defer();try{throw new Error("deferred.then was removed, use deferred.promise.then")}catch(v){i=v}return e.then=function(){b(i)},s="pending",o=r,d=arguments[arguments.length-1],d===a&&(d=++n),h=e.promise.then,e.id=d,e.promise=l(e.promise,e),p=e.promise.always,e.promise.always=w("promise.always","promise.ensure",p,e.promise),e.resolver=T(e.resolver),e.resolver.toString=function(){return y("Resolver",d,s,o)},c=e.resolver.notify,e.notify=e.resolver.notify=function(t){return g("progress",e,t),c(t)},u=e.resolver.resolve,e.resolve=e.resolver.resolve=function(t){return o=t,s="resolving",g("resolve",e,t),u.apply(a,arguments)},f=e.resolver.reject,e.reject=e.resolver.reject=function(e){return o=e,s="REJECTING",f.apply(a,arguments)},e.toString=function(){return y("Deferred",d,s,o)},h(function(e){return s="resolved",e},function(e){return s="REJECTED",t.reject(e)}),e.resolver.id=d,e}function p(e,n){f[e]=function(){return l(n.apply(t,arguments))}}function d(e,n,r){p(e,function(){return r=r||1,(typeof arguments[r]=="function"||typeof arguments[r+1]=="function"||typeof arguments[r+2]=="function")&&o(e+"() onFulfilled, onRejected, and onProgress are deprecated, use returnedPromise.then/otherwise/ensure instead"),n.apply(t,arguments)})}function v(e,t){return function(n){try{return t(n)}catch(r){if(r){var s=f.debug&&f.debug.exceptionsToRethrow||i;r.name in s&&b(r),g("reject",e,r)}throw r}}}function m(e,t){var n,r,i,s;r=[];for(s=0,i=t.length;s<i;s++)r[s]=typeof (n=t[s])=="function"?v(e,n):n;return r}function g(e,t,n,r){var i=f.debug;if(!i||typeof i[e]!="function")return;if(arguments.length<4&&e=="reject")try{throw new Error(t.toString())}catch(s){r=s}try{i[e](t,n,r)}catch(o){b(new Error("when.js global debug handler threw: "+String(o)))}}function y(e,t,n,i){var s="[object "+e+" "+t+"]";return arguments.length>2&&(s+=" "+n,i!==r&&(s+=": "+i)),s}function b(e){u(function(){throw e},0)}function w(e,t,n,r){return function(){return o((new Error(e+" is deprecated, use "+t)).stack),n.apply(r,arguments)}}function E(){var e,t,n;for(e=0,t=arguments.length;e<t;e++)n=arguments[e],S(n)||o((new Error("arg "+e+" must be a function, null, or undefined, but was a "+typeof n)).stack)}function S(e){return typeof e=="function"||e==null}function x(){}function T(e){return x.prototype=e,e=new x,x.prototype=a,e}var t,n,r,i,s,o,u,a;t=e("./when"),n=0,r={},s=Object.prototype.hasOwnProperty,o=typeof console!="undefined"&&typeof console.warn=="function"?function(e){console.warn(e)}:function(){},u=typeof vertx=="object"?function(e,t){return vertx.setTimer(t,e)}:setTimeout,i={RangeError:1,ReferenceError:1,SyntaxError:1,TypeError:1},o("when/debug is deprecated and will be removed. Use when/monitor/console instead"),f.defer=c,f.isPromise=t.isPromise,d("all",t.all),d("any",t.any),d("some",t.some,2);for(var h in t)t.hasOwnProperty(h)&&!(h in f)&&p(h,t[h]);return f})})(typeof define=="function"&&define.amd?define:function(e){module.exports=e(require)});