//
//  ____  _                           _
// / ___|| |_ __ _ _ __   ___  ___   (_)___  (*)
// \___ \| __/ _` | '_ \ / _ \/ __|  | / __|
//  ___) | || (_| | |_) |  __/\__ \_ | \__ \
// |____/ \__\__,_| .__/ \___||___(_)/ |___/
//              |_|              |__/
//
// (*) a (really) tiny Javascript MVC microframework
//
// (c) Hay Kranen < hay@bykr.org >
// Released under the terms of the MIT license
// < http://en.wikipedia.org/wiki/MIT_License >
//
// Stapes.js : http://hay.github.com/stapes

(function(){var e="0.8.0",t=1;if(!Object.create)var n=function(){};var r=Array.prototype.slice,i={attributes:{},eventHandlers:{"-1":{}},guid:-1,addEvent:function(e){i.eventHandlers[e.guid][e.type]||(i.eventHandlers[e.guid][e.type]=[]),i.eventHandlers[e.guid][e.type].push({guid:e.guid,handler:e.handler,scope:e.scope,type:e.type})},addEventHandler:function(e,t,n){var r={},s;typeof e=="string"?(s=n||!1,r[e]=t):(s=t||!1,r=e);for(var o in r){var u=r[o],a=o.split(" ");for(var f=0,l=a.length;f<l;f++){var c=a[f];i.addEvent.call(this,{guid:this._guid||this._.guid,handler:u,scope:s,type:c})}}},addGuid:function(e,n){if(e._guid&&!n)return;e._guid=t++,i.attributes[e._guid]={},i.eventHandlers[e._guid]={}},attr:function(e){return i.attributes[e]},clone:function(e){var t=i.typeOf(e);if(t==="object")return i.extend({},e);if(t==="array")return e.slice(0)},create:function(e){return Object.create?Object.create(e):(n.prototype=e,new n)},createSubclass:function(e,t){function o(){if(!(this instanceof o))throw new Error("Please use 'new' when initializing Stapes classes");this.on&&i.addGuid(this,!0),r.apply(this,arguments)}e=e||{},t=t||!1;var n=e.superclass.prototype,r=e.hasOwnProperty("constructor")?e.constructor:function(){};t&&i.extend(n,s),o.prototype=i.create(n),o.prototype.constructor=o,i.extend(o,{extend:function(){return i.extendThis.apply(this,arguments)},parent:n,proto:function(){return i.extendThis.apply(this.prototype,arguments)},subclass:function(e){return e=e||{},e.superclass=this,i.createSubclass(e)}});for(var u in e)u!=="constructor"&&u!=="superclass"&&(o.prototype[u]=e[u]);return o},emitEvents:function(e,t,n,s){n=n||!1,s=s||this._guid;var o=r.call(i.eventHandlers[s][e]);for(var u=0,a=o.length;u<a;u++){var f=i.extend({},o[u]),l=f.scope?f.scope:this;n&&(f.type=n),f.scope=l,f.handler.call(f.scope,t,f)}},extend:function(){var e=r.call(arguments),t=e.shift();for(var n=0,i=e.length;n<i;n++){var s=e[n];for(var o in s)t[o]=s[o]}return t},extendThis:function(){var e=r.call(arguments);return e.unshift(this),i.extend.apply(this,e)},makeUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})},removeAttribute:function(e,t){t=t||!1;var n=i.trim(e).split(" ");for(var r=0,s=n.length;r<s;r++){var o=i.trim(n[r]);o&&(delete i.attr(this._guid)[o],t||(this.emit("change",o),this.emit("change:"+o),this.emit("remove",o),this.emit("remove:"+o)))}},removeEventHandler:function(e,t){var n=i.eventHandlers[this._guid];if(e&&t){n=n[e];if(!n)return;for(var r=0,s=n.length,o;r<s;r++)o=n[r].handler,o&&o===t&&(n.splice(r--,1),s--)}else e?delete n[e]:i.eventHandlers[this._guid]={}},setAttribute:function(e,t,n){n=n||!1;var r=this.has(e),s=i.attr(this._guid)[e];if(t===s)return;i.attr(this._guid)[e]=t;if(n)return;this.emit("change",e),this.emit("change:"+e,t);var o={key:e,newValue:t,oldValue:s||null};this.emit("mutate",o),this.emit("mutate:"+e,o);var u=r?"update":"create";this.emit(u,e),this.emit(u+":"+e,t)},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},typeOf:function(e){return e===null||typeof e=="undefined"?String(e):Object.prototype.toString.call(e).replace(/\[object |\]/g,"").toLowerCase()},updateAttribute:function(e,t,n){var r=this.get(e),s=i.typeOf(r);if(s==="object"||s==="array")r=i.clone(r);var o=t.call(this,r,e);i.setAttribute.call(this,e,o,n||!1)}},s={emit:function(e,t){t=typeof t=="undefined"?null:t;var n=e.split(" ");for(var r=0,s=n.length;r<s;r++){var o=n[r];i.eventHandlers[-1].all&&i.emitEvents.call(this,"all",t,o,-1),i.eventHandlers[-1][o]&&i.emitEvents.call(this,o,t,o,-1),typeof this._guid=="number"&&(i.eventHandlers[this._guid].all&&i.emitEvents.call(this,"all",t,o),i.eventHandlers[this._guid][o]&&i.emitEvents.call(this,o,t))}},off:function(){i.removeEventHandler.apply(this,arguments)},on:function(){i.addEventHandler.apply(this,arguments)}};i.Module=function(){},i.Module.prototype={each:function(e,t){var n=i.attr(this._guid);for(var r in n){var s=n[r];e.call(t||this,s,r)}},extend:function(){return i.extendThis.apply(this,arguments)},filter:function(e){var t=[],n=i.attr(this._guid);for(var r in n)e.call(this,n[r],r)&&t.push(n[r]);return t},get:function(e){if(typeof e=="string")return this.has(e)?i.attr(this._guid)[e]:null;if(typeof e=="function"){var t=this.filter(e);return t.length?t[0]:null}},getAll:function(){return i.clone(i.attr(this._guid))},getAllAsArray:function(){var e=[],t=i.attr(this._guid);for(var n in t){var r=t[n];i.typeOf(r)==="object"&&!r.id&&(r.id=n),e.push(r)}return e},has:function(e){return typeof i.attr(this._guid)[e]!="undefined"},map:function(e,t){var n=[];return this.each(function(r,i){n.push(e.call(t||this,r,i))},t||this),n},push:function(e,t){if(i.typeOf(e)==="array")for(var n=0,r=e.length;n<r;n++)i.setAttribute.call(this,i.makeUuid(),e[n],t||!1);else i.setAttribute.call(this,i.makeUuid(),e,t||!1);return this},remove:function(e,t){return typeof e=="undefined"?(i.attributes[this._guid]={},this.emit("change remove")):typeof e=="function"?this.each(function(n,r){e(n)&&i.removeAttribute.call(this,r,t)}):i.removeAttribute.call(this,e,t||!1),this},set:function(e,t,n){if(typeof e=="object")for(var r in e)i.setAttribute.call(this,r,e[r],t||!1);else i.setAttribute.call(this,e,t,n||!1);return this},size:function(){var e=0,t=i.attr(this._guid);for(var n in t)e++;return e},update:function(e,t,n){return typeof e=="string"?i.updateAttribute.call(this,e,t,n||!1):typeof e=="function"&&this.each(function(t,n){i.updateAttribute.call(this,n,e)}),this}};var o={_:i,extend:function(){return i.extendThis.apply(i.Module.prototype,arguments)},mixinEvents:function(e){return e=e||{},i.addGuid(e),i.extend(e,s)},on:function(){i.addEventHandler.apply(this,arguments)},subclass:function(e,t){return t=t||!1,e=e||{},e.superclass=t?function(){}:i.Module,i.createSubclass(e,!t)},version:e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=o),exports.Stapes=o):typeof define=="function"&&define.amd?define([],function(){return o}):window.Stapes=o})();